import sys
import csv 

data_not_ground = []
with open('big_vul_T3_final.csv', 'r') as f:
    reader = csv.DictReader(f)
    for row in reader:
      data_not_ground.append(row)
      
    
    
count_TP = 0
count_TN = 0
count_FP = 0
count_FN = 0
count_extra_FN = 0

with open('big_vul_relation_with_tf_T3_redo_final.csv', 'w') as f:
    writer = csv.DictWriter(f, fieldnames=['Index', 'CWE', 'Vulnerable', 'relation-with-Top-3', '#relevant-top-3', 'relations', 'TP', 'TN', 'FP', 'FN', 'Extra FN', 'similar-id-1', 'similar-id-2', 'similar-id-3'])#, 'similar-id-4', 'similar-id-5', 'similar-id-6', 'similar-id-7', 'similar-id-8', 'similar-id-9', 'similar-id-10'])
    writer.writeheader()
    for x in data_not_ground:
        record = {'Index': x['Index'],
                  'CWE': x['CWE'],
                  'Vulnerable': x['Vulnerable'],
                'relation-with-Top-3': x['relation-with-Top-3'],
                '#relevant-top-3': x['#relevant-top-3'],
                'relations': x['relations'],
                'similar-id-1': x['similar-id-1'],
                'similar-id-2': x['similar-id-2'],
                'similar-id-3': x['similar-id-3'], 
                'TP': '',
                'TN': '',
                'FP': '',
                'FN': '',
                'Extra FN': ''}
            
        
        #print(x['#relevant-top-3'], y['top_choice_vulnerable'])
                    
        if int(x['#relevant-top-3']) > 0 and x['Vulnerable'] == '1': #Something return by sbert (at least cwe must be related to original cwe) and actually vulnerable
            record['TP'] = 'Yes'
            count_TP += 1
            
        elif x['similar-id-1'] != '' and x['Vulnerable'] == '0':  #Something return by sbert and actually not vulnerable
            record['FP'] = 'Yes'
            count_FP += 1
            
        elif (x['similar-id-1'] == '' and x['Vulnerable'] == '1'): # Nothing return by sbert and actually vulnerable
            record['FN'] = 'Yes'
            count_FN += 1
            
        elif x['similar-id-1'] == '' and x['Vulnerable'] == '0':    #Nothing return by sbert and actually not vulnerable
            record['TN'] = 'Yes'
            count_TN += 1
            
        elif x['similar-id-1'] != '' and int(x['#relevant-top-3']) == 0 and x['Vulnerable'] == '1':
            record['Extra FN'] = 'Yes'
            count_extra_FN += 1
                    
        writer.writerow(record) 
        
        
print('TP: ', count_TP)
print('TN: ', count_TN)
print('FP: ', count_FP)
print('FN: ', count_FN)
print('Extra FN: ', count_extra_FN)