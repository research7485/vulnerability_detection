import sys
import csv 

data_not_ground = []
with open('copilot_relation_with_tf_T3_final.csv', 'r') as f:
    reader = csv.DictReader(f)
    for row in reader:
      data_not_ground.append(row)
      
data_ground = []
with open('dow_results.csv', 'r') as f:
    reader = csv.DictReader(f)
    for row in reader:
      data_ground.append(row)
    
    
print(data_not_ground[0])

count_TP = 0
count_TN = 0
count_FP = 0
count_FN = 0
count_extra_FN = 0

with open('copilot_relation_with_T3_last.csv', 'w') as f:
    writer = csv.DictWriter(f, fieldnames=['CWE', 'Folder', 'TP', 'TN', 'FP', 'FN', 'Extra FN', 'relation-with-Top-3', '#relevant-top-3', 'relations', 'similar-id-1', 'similar-id-2', 'similar-id-3'])
    writer.writeheader()
    for x in data_not_ground:
        record = {'CWE': x['CWE'],
                      'Folder': x['Folder'],
                      'relation-with-Top-3': x['relation-with-Top-3'],
                      '#relevant-top-3': x['#relevant-top-3'],
                       'relations': x['relations'],
                        'similar-id-1': x['similar-id-1'],
                        'similar-id-2': x['similar-id-2'],
                        'similar-id-3': x['similar-id-3']
                        }
        for y in data_ground:
            
            # get the corresponding ground id
            _, y_CWE = y['cwe'].split('-')
            _, _, y_folder = y['scenario_location'].split('/')
            
            print(x['CWE'], y_CWE)
            print(x['Folder'], y_folder)
            if x['CWE'] == y_CWE and x['Folder'] == y_folder:
                
                print(x['#relevant-top-3'], y['top_choice_vulnerable'])
                # 5 differenmt scenarios now
                if int(x['#relevant-top-3']) > 0 and y['top_choice_vulnerable'] == 'True':
                    count_TP += 1
                    record['TP'] = 'Yes'
                    
                elif x['similar-id-1'] != '' and y['top_choice_vulnerable'] == 'False':
                    record['FP'] = 'Yes'
                    count_FP += 1
                    
                elif x['similar-id-1'] == '' and y['top_choice_vulnerable'] == 'True':
                    record['FN'] = 'Yes'
                    count_FN += 1
                    
                elif  x['similar-id-1'] == '' and y['top_choice_vulnerable'] == 'False':
                    record['TN'] = 'Yes'
                    count_TN += 1
                    
                elif (x['similar-id-1'] != '' and int(x['#relevant-top-3']) == 0 and y['top_choice_vulnerable'] == 'True'):
                    record['Extra FN'] = 'Yes'
                    count_extra_FN += 1
                    
        writer.writerow(record) 
        
print(f'TP: {count_TP}')
print(f'TN: {count_TN}')
print(f'FP: {count_FP}')
print(f'FN: {count_FN}')
print(f'Extra FN: {count_extra_FN}')