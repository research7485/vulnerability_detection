import csv

def main():
    function_data = function_reader('dfBigVulFinal.csv')
    description_data = description_reader('palm_descriptions_for_big_vul.csv')
    
    #print(function_data[0])
    
    # Some code to join data
    store_data = []          # list of dictionaries
    
    # for every row in description data, there should be a row for description data
    for description_row in description_data:
        for function_row in function_data:
            if description_row['Index'] == function_row['Index']:
                # code to create a joined dictionary and add it to our list
                temp = {}
                temp['Index'] = description_row['Index']
                temp['CWE_ID'] = description_row['CWE_ID']
                temp['func'] = description_row['Palm_Description'] + '\n' + function_row['func']
                temp['Target'] = function_row['target']
                store_data.append(temp)
                break
            
    print(len(store_data))
    
    with open('codeBert_input.csv', 'w') as f:
        writer = csv.DictWriter(f, fieldnames=['Index', 'CWE_ID', 'func', 'Target'])
        writer.writeheader()
        for row in store_data: 
           writer.writerow(row)
    
def description_reader(file_name):
    data = []  
    
    with open(file_name, 'r') as f:
        reader = csv.DictReader(f)
        for row in reader:
            if row['Palm_Description'].strip() != '':
                temp = {}
                temp['Index'] = row['Index']
                temp['CWE_ID'] = row['CWE_ID']
                temp['Palm_Description'] = row['Palm_Description']
                data.append(temp)
    
    print(len(data))                
    return data
    
def function_reader(file_name):
    data = []  
    
    with open(file_name, 'r') as f:
        reader = csv.DictReader(f)
        for row in reader:
            if row['CWE ID'] != '':       # bc some record doesnt have cwe associtated to them
                temp = {}
                temp['Index'] = row['\ufeffIdx']
                temp['CWE_ID'] = row['CWE ID']
                temp['func'] = row['func']
                temp['target'] = row['target']
                data.append(temp)
                            
    return data
    
if __name__ == '__main__':
    main()